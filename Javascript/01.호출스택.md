## 자바스크립트 엔진

자바스크립트 엔진은 다음과 같은 두 가지 구성 요소로 이루어져 있다.

> **메모리 힙 (Memory Heap)**
>
> 객체와 변수에 대한 메모리 할당

> **호출 스택 (Call Stack)**
>
> 코드가 실행될 때 호출 스택이 쌓인다

###  

## 실행 환경 (브라우저)

이러한 자바스크립트는 브라우저 (또는 노드) 에서 실행된다. 따라서 자바스크립트가 직접 제공하지는 않지만 브라우저에서 제공하는 다양한 웹 api (DOM, ajax, setTimeOut 등..) 을 사용할 수 있다. 그리고 이러한 웹 api를 관리하기 위해 브라우저에는 `Event Queue` 와 `Event Loop` 가 존재한다.

###    

## 호출 스택 (Call Stack)

자바스크립트는 단일 스레드 프로그래밍 언어이므로 단일 호출 스택이 있다. 즉 한 번에 하나의 일을 처리할 수 있다. 결과적으로 코드가 실행되면서 함수를 실행할 때, 해당 함수는 스택에 push된다. 그리고 함수의 결과값을 반환하면 스택에 쌓여있던 함수는 pop된다. 아래는 함수 예제와 호출 스택에서 push와 pop이 발생하는 과정이다.

```javascript
function multiply(x, y) {
    return x * y;
}
function getSquare(x) {
    var s = multiply(x, x);
    console.log(s);
}
getSquare(5);
```

###### 1. 함수 getSquare(5)이 호출 스택에 push - 함수 multiply가 먼저 나오지만 이는 함수 선언부일 뿐 실행은 아직 되지 않았기 때문에 getSquare가 가장 우선 스택에 쌓인다.

> ###### [ getSquare(5) ]

###### 2. 함수 getSquare가 실행되고 그 다음으로 multiply(x, x) 함수가 실행되고 그 다음 스택에 쌓인다.

> ###### [ getSquare(5), multiply(x, x) ]

###### 3. multiply(x, x) 함수가 끝나고 return 값이 s에 할당된 후, 스택에 있는 해당 함수는 제거된다.

> ###### [ getSquare(5) ]

###### 4. 그 다음 console.log(s) 가 실행되어 스택에 쌓이고, s 값을 출력한 후 스택에서 제거된다.

> ###### [ getSquare(5), console.log(s) ] > [ getSquare(5) ]

###### 5. 최종적으로 getSqure(5) 함수도 스택에서 제거된다.

> ###### [ ]

###   

또한 이러한 스택의 호출 과정은 예외가 발생했을 때 (Error) 도 확인할 수 있다.

```javascript
function foo() {
    throw new Error('Error is occurred');
}
function bar() {
    foo();
}
function start() {
    bar();
}
start();
```

위의 코드는 다음과 같은 결과를 보여준다. 

> Uncaught Error: SessionStack will help you resolve crashes :)
>     at foo (<anonymous>:3:11)
>     at bar (<anonymous>:6:5)
>     at start (<anonymous>:10:5)
>     at <anonymous>:15:1

해당 에러가 foo 함수에서 발생했고, 해당 함수는 bar 함수 내에서 실행됐고, 그 함수는 start 함수내에서 실행된 것으로 확인할 수 있다. 즉 Call Stack에 함수가 실행될 때마다 기록했기 때문에 특정 오류가 발생했을 때, 이 오류가 어떤 함수로부터 시작됐는지 확인할 수 있다.

